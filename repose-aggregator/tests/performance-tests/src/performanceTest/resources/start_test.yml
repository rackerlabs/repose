- hosts: localhost
  connection: local
  gather_facts: True
  vars_files:
    - test_vars/{{ perf_test }}.yml
  roles:
    - cloud_resource_create

- hosts: performance
  gather_facts: True
  vars_files:
    - test_vars/{{ perf_test }}.yml
  roles:
    - repose

- hosts: performance
  gather_facts: True
  vars_files:
    - test_vars/{{ perf_test }}.yml
  tasks:
    - name: Set Telegraf tags
      set_fact:
        telegraf_tags:
          repose_version: "{{ repose_version|replace('.', '-') }}"
          test_name: "{{ gatling.test.id|default(gatling.test.name) }}"

- hosts: performance
  gather_facts: True
  vars_files:
    - test_vars/{{ perf_test }}.yml
  roles:
    - rossmcdonald.telegraf
    - jmxtrans

- hosts: test_agent
  gather_facts: True
  vars_files:
    - test_vars/{{ perf_test }}.yml
  roles:
    - gatling
