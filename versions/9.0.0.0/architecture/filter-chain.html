<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>9.0.0.0 | Architecture | Filter Chain</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="/_stylesheets/asciibinder.css" >
  <link rel="stylesheet" href="/_stylesheets/repose.css" >
  <link rel="stylesheet" href="/_stylesheets/release-note-categories.css" >

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="/favicon.ico"><![endif]-->
  <meta content="AsciiBinder" name="application-name">
</head>
<body onload="selectVersion('9.0.0.0');">
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a class="navbar-brand" href="http://www.openrepose.org/">
          <img alt="OpenRepose" src="/_images/repose-logo.png" align="bottom">
        </a>
      </li>
      <li class="sitename">
        <a href="../../index.html">
          Home
        </a>
      </li>
      <li class="hidden-xs active">
        <a href="/versions/9.0.0.0/welcome/index.html">
          Repose
        </a>
        <select id="version-selector" onchange="versionSelector(this);" w3-include-html="/_includes/versions.html">
        </select>
      </li>
      <li class="hidden-xs active">
        <a href="../architecture/index.html">Architecture</a>
      </li>
      
      <li class="hidden-xs active">
        Filter Chain
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <a class="navbar-search" href="/versions/search.html">
          <span class="glyphicon glyphicon-search"/>
          Search
        </a>
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-right"></span>Welcome to Repose
      </a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../welcome/index.html">Welcome</a></li>
            <li><a class="" href="../welcome/troubleshooting.html">Troubleshooting</a></li>
            <li><a class="" href="../welcome/release-notes.html">Release Notes</a></li>
            <li><a class="" href="../welcome/ver-9-upgrade-notes.html">Version 9 Upgrade Notes</a></li>
            <li><a class="" href="../welcome/style-guide.html">Style Guide</a></li>
            <li><a class="" href="../welcome/faq.html">FAQ</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-down"></span>Architecture
      </a>
      <ul id="topicGroup1" class="collapse in list-unstyled">
            <li><a class="" href="../architecture/index.html">Overview</a></li>
            <li><a class="" href="../architecture/configuration.html">Configuration</a></li>
            <li><a class="" href="../architecture/container.html">Container</a></li>
            <li><a class=" active" href="../architecture/filter-chain.html">Filter Chain</a></li>
            <li><a class="" href="../architecture/packages.html">Packages</a></li>
            <li><a class="" href="../architecture/servlet-spec.html">Servlet Specification</a></li>
            <li><a class="" href="../architecture/system-model.html">System Model</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup2">
        <span id="tgSpan2" class="fa fa-angle-right"></span>Recipes
      </a>
      <ul id="topicGroup2" class="collapse  list-unstyled">
            <li><a class="" href="../recipes/index.html">Overview</a></li>
            <li><a class="" href="../recipes/quick-start.html">Quick Start</a></li>
            <li><a class="" href="../recipes/getting-started.html">Getting Started</a></li>
            <li><a class="" href="../recipes/custom-filter-for-repose.html">Custom Filter for Repose</a></li>
            <li><a class="" href="../recipes/docker.html">Docker</a></li>
            <li><a class="" href="../recipes/performance-best-practices.html">Performance Best Practices</a></li>
            <li><a class="" href="../recipes/role-based-access-control.html">Role Based Access Control</a></li>
            <li><a class="" href="../recipes/running-valve.html">Running Valve</a></li>
            <li><a class="" href="../recipes/valve-installation.html">Valve Installation</a></li>
            <li><a class="" href="../recipes/echo-server.html">Echo Server</a></li>
            <li><a class="" href="../recipes/rate-limiting.html">Rate Limiting</a></li>
            <li><a class="" href="../recipes/multi-tenant.html">Multi Tenant Authorization</a></li>
            <li><a class="" href="../recipes/user-access-events.html">User Access Events</a></li>
            <li><a class="" href="../recipes/basic-authentication.html">Basic Authentication</a></li>
            <li><a class="" href="../recipes/delegation.html">Delegation</a></li>
            <li><a class="" href="../recipes/preventing-xml-bomb.html">Preventing XML bomb attacks</a></li>
            <li><a class="" href="../recipes/api-event-flume.html">API Access Event Recording with Flume</a></li>
            <li><a class="" href="../recipes/xsd-versioning.html">XSD Versioning Guidelines</a></li>
            <li><a class="" href="../recipes/client-authentication.html">SSL/TLS Client Authentication</a></li>
            <li><a class="" href="../recipes/functional-test-framework.html">Functional Test Framework</a></li>
            <li><a class="" href="../recipes/header-splitting.html">Header Splitting</a></li>
            <li><a class="" href="../recipes/reason-phrase-normalization.html">Reason Phrase Normalization</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup3">
        <span id="tgSpan3" class="fa fa-angle-right"></span>Filters
      </a>
      <ul id="topicGroup3" class="collapse  list-unstyled">
            <li><a class="" href="../filters/index.html">Overview</a></li>
            <li><a class="" href="../filters/add-header.html">Add Header Filter</a></li>
            <li><a class="" href="../filters/api-validator.html">API Validator Filter</a></li>
            <li><a class="" href="../filters/body-extractor-to-header.html">Body Extractor to Header Filter</a></li>
            <li><a class="" href="../filters/body-patcher.html">Body Patcher Filter</a></li>
            <li><a class="" href="../filters/compression.html">Compression Filter</a></li>
            <li><a class="" href="../filters/content-type-stripper.html">Content Type Stripper Filter</a></li>
            <li><a class="" href="../filters/cors.html">CORS Filter</a></li>
            <li><a class="" href="../filters/derp.html">Delegation Response Processor (DeRP) Filter</a></li>
            <li><a class="" href="../filters/destination-router.html">Destination Router Filter</a></li>
            <li><a class="" href="../filters/echo.html">Echo Filter</a></li>
            <li><a class="" href="../filters/exception.html">Exception Filter</a></li>
            <li><a class="" href="../filters/forwarded-proto.html">Forwarded Protocol Filter</a></li>
            <li><a class="" href="../filters/header-normalization.html">Header Normalization filter</a></li>
            <li><a class="" href="../filters/header-translation.html">Header Translation Filter</a></li>
            <li><a class="" href="../filters/header-user.html">Header User Filter</a></li>
            <li><a class="" href="../filters/herp.html">Highly Efficient Record Processor (HERP) Filter</a></li>
            <li><a class="" href="../filters/ip-user.html">IP User Filter</a></li>
            <li><a class="" href="../filters/iri-validator.html">IRI Validator Filter</a></li>
            <li><a class="" href="../filters/keystone-v2.html">Keystone v2 Filter</a></li>
            <li><a class="" href="../filters/keystone-v2-authorization.html">Keystone v2 Authorization Filter</a></li>
            <li><a class="" href="../filters/keystone-v2-basic-auth.html">Keystone v2 Basic Auth Filter</a></li>
            <li><a class="" href="../filters/merge-header.html">Merge Header Filter</a></li>
            <li><a class="" href="../filters/openstack-identity-v3.html">Openstack Identity v3 Filter</a></li>
            <li><a class="" href="../filters/rate-limiting.html">Rate Limiting Filter</a></li>
            <li><a class="" href="../filters/regex-rbac.html">RegEx Role Based Access Control (RBAC) Filter</a></li>
            <li><a class="" href="../filters/scripting.html">Scripting Filter</a></li>
            <li><a class="" href="../filters/simple-rbac.html">Simple Role Based Access Control (RBAC) Filter</a></li>
            <li><a class="" href="../filters/slf4j-http-logging.html">SFL4J HTTP Logging Filter</a></li>
            <li><a class="" href="../filters/split-header.html">Split Header Filter</a></li>
            <li><a class="" href="../filters/tenant-culling.html">Tenant Culling Filter</a></li>
            <li><a class="" href="../filters/translation.html">Translation Filter</a></li>
            <li><a class="" href="../filters/uri-normalization.html">URI Normalization Filter</a></li>
            <li><a class="" href="../filters/uri-stripper.html">URI Stripper Filter</a></li>
            <li><a class="" href="../filters/uri-user.html">URI User Filter</a></li>
            <li><a class="" href="../filters/url-extractor-to-header.html">URL Extractor to Header Filter</a></li>
            <li><a class="" href="../filters/valkyrie-authorization.html">Valkyrie Authorization Filter</a></li>
            <li><a class="" href="../filters/versioning.html">Versioning Filter</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup4">
        <span id="tgSpan4" class="fa fa-angle-right"></span>Services
      </a>
      <ul id="topicGroup4" class="collapse  list-unstyled">
            <li><a class="" href="../services/index.html">Overview</a></li>
            <li><a class="" href="../services/atom-feed-consumption.html">Atom Feed Consumption Service</a></li>
            <li><a class="" href="../services/datastores.html">Datastores</a></li>
            <li><a class="" href="../services/health-check.html">Health Check Service</a></li>
            <li><a class="" href="../services/http-client.html">HTTP Client Service</a></li>
            <li><a class="" href="../services/logging.html">Logging Service</a></li>
            <li><a class="" href="../services/metrics.html">Metrics Service</a></li>
            <li><a class="" href="../services/open-tracing.html">OpenTracing Service</a></li>
            <li><a class="" href="../services/phone-home.html">Phone Home Service</a></li>
            <li><a class="" href="../services/uri-redaction.html">URI Redaction service</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup5">
        <span id="tgSpan5" class="fa fa-angle-right"></span>Developer
      </a>
      <ul id="topicGroup5" class="collapse  list-unstyled">
            <li><a class="" href="../developer/index.html">Overview</a></li>
            <li><a class="" href="../developer/docker.html">Docker</a></li>
            <li><a class="" href="../developer/performance.html">Performance</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Filter Chain</h2>
        </div>
        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>Repose</strong> filter chain is the work horse of the system, and is responsible for nearly all enrichment that <strong>Repose</strong> provides.
It&#8217;s based on and uses the same contract as the <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/FilterChain.html">JEE Filter Chain</a>.
As the name implies it is a chain of filters that are followed in order.
A request goes through them from the first, one after another, until the last is reached when the request which has possibly been mutated along the way is sent on to the origin service.
When the response comes back from the origin service it works it&#8217;s way back up the chain in the opposite order.</p>
</div>
<div class="paragraph">
<p>The <strong>Repose</strong> filter chain provides a number of enhancements over the standard filter chain contract that gives a lot of power and extra value.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dynamic-filtering"><a class="anchor" href="#dynamic-filtering"></a>Dynamic Filtering</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Typically a filter chain is static and unchanging.
Your request will pass through every single filter everytime regardless of whether you want it to or not.
The <strong>Repose</strong> filter chain allows you to determine if a filter should be run while the request is processing.</p>
</div>
<div class="sect2">
<h3 id="uri-regex"><a class="anchor" href="#uri-regex"></a>URI Regex</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This method of determining if a filter should be run is <strong>DEPRECATED</strong> and will be removed in <strong>Repose</strong> 10.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can decide whether or not a filter should run based on the path of it&#8217;s URI using a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">regular expression</a>.
Here&#8217;s a simple example:</p>
</div>
<div class="listingblock">
<div class="title">system-model.cfg.xml (partial)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span style="color:#070;font-weight:bold">&lt;filters&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;filter</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">keystone-v2</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">uri-regex</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">.*/foo</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span style="color:#070;font-weight:bold">&lt;filter</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">api-validator</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span style="color:#070;font-weight:bold">&lt;/filters&gt;</span>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This filter will only be run when the request is to a resource ending in <code>/foo</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This filter will be run everytime.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It&#8217;s worth noting that if anything changes the request uri while processing the filter chain that will potentially impact whether a filter is run.
Or in other words the filters to be run is not determined up front, but instead evaluated when the request hits a given filter in the chain.</p>
</div>
</div>
<div class="sect2">
<h3 id="filter-activation-determination"><a class="anchor" href="#filter-activation-determination"></a>Filter Activation Determination</h3>
<div class="paragraph">
<p>You can configure whether or not a filter should run based on each of the following HTTP Request criterion:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Method verb</p>
</li>
<li>
<p>Header presence</p>
</li>
<li>
<p>Header Value based on a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">regular expression</a></p>
</li>
<li>
<p>URI based on a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">regular expression</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is further customizable through the use of the following boolean logic operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>And</p>
</li>
<li>
<p>Or</p>
</li>
<li>
<p>Not</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The filter chain is dynamic.
It is not determined at the start of the request, rather before each filter is executed the request is compared against the configured criteria.
This means that anything that modifies the request may effect whether a later filter will process or not.
For example, the <a href="../filters/body-extractor-to-header.html">Body Extractor to Header Filter</a> could add a header based on the request body which is used to determine if a later filter executes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Refer to <a href="system-model.html#_filter_activation_determination">System Model Filter Activation Determination</a> for further details about configuring this capability.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="intrafilter-logging"><a class="anchor" href="#intrafilter-logging"></a>Intrafilter Logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes you won&#8217;t get the output you expect from the filter chain whether that&#8217;s to your origin service or your customer that originated the request.
Intrafilter logging will let you get a look into what effect each filter is having on both the request and response.
All you have to do is change this line in your logging configuration, from:</p>
</div>
<div class="listingblock">
<div class="title">log4j2.xml (partial)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span style="color:#070;font-weight:bold">&lt;Logger</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">intrafilter-logging</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">level</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">info</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="title">log4j2.xml (partial)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span style="color:#070;font-weight:bold">&lt;Logger</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">intrafilter-logging</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">level</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">trace</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will convert both the request and response into a simple JSON object that will be written out into the logs.
And it will do this before each filter and the origin service allowing you to see how each filter mutated them.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This can be expensive in both time and disk space and is intended only as a debugging tool, not for full time use.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more troubleshooting help see our <a href="#../troubleshooting.adoc">guide</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metrics"><a class="anchor" href="#metrics"></a>Metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Repose</strong> automatically records metrics on how long each request spends within a filter.
If you wish to see these numbers or exfiltrate them to another tool look into the <a href="#../services/metrics.adoc">Metrics Service</a>.
They are listed under <code>org.openrepose.core.FilterProcessingTime.Delay</code> with an entry for each filter by name.</p>
</div>
<div class="paragraph">
<p>If you are curious about the numbers for a specific request you can add the <code>X-Trace-Request</code> header to the request.
See <a href="../troubleshooting.html#_time_spent_in_each_filter">Time Spent in Each Filter</a> for more details.</p>
</div>
<div class="paragraph">
<p>We also start an <strong>OpenTracing</strong> span for each filter that is ran.
If you&#8217;d like to get this data look into the <a href="#../services/open-tracing.adoc">OpenTracing Service</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bypass-uri"><a class="anchor" href="#bypass-uri"></a>Bypass URI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes you&#8217;d like a request to entirely bypass the filter chain entirely.
The most common use case for this is if you have some sort of monitoring setup to check the responsiveness of your origin service.
We support this with a simple regular expression specified at the top of the filter chain, like so:</p>
</div>
<div class="listingblock">
<div class="title">system-model.cfg.xml (partial)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span style="color:#070;font-weight:bold">&lt;filters</span> <span style="color:#b48">bypass-uri-regex</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/healthcheck</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>  <i class="conum" data-value="1"></i><b>(1)</b>
    <span style="color:#070;font-weight:bold">&lt;filter</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">keystone-v2</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;filter</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">api-validator</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/filters&gt;</span>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Any call to <code>/healthcheck</code> will skip the entire filter chain and go straight to the origin service.</td>
</tr>
</table>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script src="/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script src="/_javascripts/page-loader.js" type="text/javascript"></script>
  <script src="/_javascripts/include-html.js" type="text/javascript"></script>
  <script>includeHTML();</script>
  <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>