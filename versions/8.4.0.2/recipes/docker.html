<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>8.4.0.2 | Recipes | Docker</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="/_stylesheets/asciibinder.css" >
  <link rel="stylesheet" href="/_stylesheets/repose.css" >

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="/favicon.ico"><![endif]-->
  <meta content="AsciiBinder" name="application-name">
</head>
<body onload="selectVersion('8.4.0.2');">
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a class="navbar-brand" href="http://www.openrepose.org/">
          <img alt="OpenRepose" src="/_images/repose-logo.png" align="bottom">
        </a>
      </li>
      <li class="sitename">
        <a href="../../index.html">
          Home
        </a>
      </li>
      <li class="hidden-xs active">
        <a href="/versions/8.4.0.2/welcome/index.html">
          Repose
        </a>
        <select id="version-selector" onchange="versionSelector(this);" w3-include-html="/_includes/versions.html">
        </select>
      </li>
      <li class="hidden-xs active">
        <a href="../recipes/index.html">Recipes</a>
      </li>
      
      <li class="hidden-xs active">
        Docker
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <a class="navbar-search" href="/versions/search.html">
          <span class="glyphicon glyphicon-search"/>
          Search
        </a>
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-right"></span>Welcome to Repose
      </a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../welcome/index.html">Welcome</a></li>
            <li><a class="" href="../welcome/troubleshooting.html">Troubleshooting</a></li>
            <li><a class="" href="../welcome/release-notes.html">Release Notes</a></li>
            <li><a class="" href="../welcome/style-guide.html">Style Guide</a></li>
            <li><a class="" href="../welcome/faq.html">FAQ</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-right"></span>Architecture
      </a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../architecture/index.html">Overview</a></li>
            <li><a class="" href="../architecture/configuration.html">Configuration</a></li>
            <li><a class="" href="../architecture/container.html">Container</a></li>
            <li><a class="" href="../architecture/packages.html">Packages</a></li>
            <li><a class="" href="../architecture/system-model.html">System Model</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup2">
        <span id="tgSpan2" class="fa fa-angle-down"></span>Recipes
      </a>
      <ul id="topicGroup2" class="collapse in list-unstyled">
            <li><a class="" href="../recipes/index.html">Overview</a></li>
            <li><a class="" href="../recipes/quick-setup.html">Quick Setup</a></li>
            <li><a class="" href="../recipes/getting-started.html">Getting Started</a></li>
            <li><a class="" href="../recipes/custom-filter-for-repose.html">Custom Filter for Repose</a></li>
            <li><a class=" active" href="../recipes/docker.html">Docker</a></li>
            <li><a class="" href="../recipes/performance-best-practices.html">Performance Best Practices</a></li>
            <li><a class="" href="../recipes/role-based-access-control.html">Role Based Access Control</a></li>
            <li><a class="" href="../recipes/running-valve.html">Running Valve</a></li>
            <li><a class="" href="../recipes/vagrant.html">Vagrant</a></li>
            <li><a class="" href="../recipes/valve-installation.html">Valve Installation</a></li>
            <li><a class="" href="../recipes/war-installation.html">WAR Installation</a></li>
            <li><a class="" href="../recipes/echo-server.html">Echo Server</a></li>
            <li><a class="" href="../recipes/rate-limiting.html">Rate Limiting</a></li>
            <li><a class="" href="../recipes/user-access-events.html">User Access Events</a></li>
            <li><a class="" href="../recipes/basic-authentication.html">Basic Authentication</a></li>
            <li><a class="" href="../recipes/distributed-rate-limiting.html">Distributed Rate Limiting</a></li>
            <li><a class="" href="../recipes/delegation.html">Delegation</a></li>
            <li><a class="" href="../recipes/preventing-xml-bomb.html">Preventing XML bomb attacks</a></li>
            <li><a class="" href="../recipes/api-event-flume.html">API Access Event Recording with Flume</a></li>
            <li><a class="" href="../recipes/xsd-versioning.html">XSD Versioning Guidelines</a></li>
            <li><a class="" href="../recipes/glassfish-setup.html">Glassfish Setup</a></li>
            <li><a class="" href="../recipes/tomcat-setup.html">Tomcat Setup</a></li>
            <li><a class="" href="../recipes/http-container-attributes.html">HTTP Container Attributes</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup3">
        <span id="tgSpan3" class="fa fa-angle-right"></span>Filters
      </a>
      <ul id="topicGroup3" class="collapse  list-unstyled">
            <li><a class="" href="../filters/index.html">Overview</a></li>
            <li><a class="" href="../filters/add-header.html">Add Header Filter</a></li>
            <li><a class="" href="../filters/api-validator.html">API Validator Filter</a></li>
            <li><a class="" href="../filters/body-extractor-to-header.html">Body Extractor to Header Filter</a></li>
            <li><a class="" href="../filters/body-patcher.html">Body Patcher Filter</a></li>
            <li><a class="" href="../filters/compression.html">Compression Filter</a></li>
            <li><a class="" href="../filters/content-type-stripper.html">Content Type Stripper Filter</a></li>
            <li><a class="" href="../filters/cors.html">CORS Filter</a></li>
            <li><a class="" href="../filters/derp.html">Delegation Response Processor (DeRP) Filter</a></li>
            <li><a class="" href="../filters/destination-router.html">Destination Router Filter</a></li>
            <li><a class="" href="../filters/echo.html">Echo Filter</a></li>
            <li><a class="" href="../filters/exception.html">Exception Filter</a></li>
            <li><a class="" href="../filters/forwarded-proto.html">Forwarded Protocol Filter</a></li>
            <li><a class="" href="../filters/header-normalization.html">Header Normalization filter</a></li>
            <li><a class="" href="../filters/header-translation.html">Header Translation Filter</a></li>
            <li><a class="" href="../filters/header-user.html">Header User Filter</a></li>
            <li><a class="" href="../filters/herp.html">Highly Efficient Record Processor (HERP) Filter</a></li>
            <li><a class="" href="../filters/ip-user.html">IP User Filter</a></li>
            <li><a class="" href="../filters/iri-validator.html">IRI Validator Filter</a></li>
            <li><a class="" href="../filters/keystone-v2.html">Keystone v2 Filter</a></li>
            <li><a class="" href="../filters/keystone-v2-basic-auth.html">Keystone v2 Basic Auth Filter</a></li>
            <li><a class="" href="../filters/merge-header.html">Merge Header Filter</a></li>
            <li><a class="" href="../filters/openstack-identity-v3.html">Openstack Identity v3 Filter</a></li>
            <li><a class="" href="../filters/rackspace-auth-user.html">Rackspace Auth User Filter</a></li>
            <li><a class="" href="../filters/rate-limiting.html">Rate Limiting Filter</a></li>
            <li><a class="" href="../filters/saml-policy.html">SAML Policy Translation Filter</a></li>
            <li><a class="" href="../filters/scripting.html">Scripting Filter</a></li>
            <li><a class="" href="../filters/simple-rbac.html">Simple Role Based Access Control (RBAC) Filter</a></li>
            <li><a class="" href="../filters/slf4j-http-logging.html">SFL4J HTTP Logging Filter</a></li>
            <li><a class="" href="../filters/translation.html">Translation Filter</a></li>
            <li><a class="" href="../filters/uri-normalization.html">URI Normalization Filter</a></li>
            <li><a class="" href="../filters/uri-stripper.html">URI Stripper Filter</a></li>
            <li><a class="" href="../filters/uri-user.html">URI User Filter</a></li>
            <li><a class="" href="../filters/url-extractor-to-header.html">URL Extractor to Header Filter</a></li>
            <li><a class="" href="../filters/valkyrie-authorization.html">Valkyrie Authorization Filter</a></li>
            <li><a class="" href="../filters/versioning.html">Versioning Filter</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup4">
        <span id="tgSpan4" class="fa fa-angle-right"></span>Services
      </a>
      <ul id="topicGroup4" class="collapse  list-unstyled">
            <li><a class="" href="../services/index.html">Overview</a></li>
            <li><a class="" href="../services/atom-feed-consumption.html">Atom Feed Consumption Service</a></li>
            <li><a class="" href="../services/datastores.html">Datastores</a></li>
            <li><a class="" href="../services/health-check.html">Health Check service</a></li>
            <li><a class="" href="../services/http-connection-pool.html">HTTP Connection Pool service</a></li>
            <li><a class="" href="../services/phone-home.html">Phone Home Service</a></li>
            <li><a class="" href="../services/response-messaging.html">Response Messaging service</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Docker</h2>
        </div>
        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>With the advent of container technology, Repose can be fully encapsulated and run as a service.
By bundling the environment with the software itself, deploying Repose becomes a much quicker, simpler process.
Docker boasts security through isolation, and when run on platforms with native support, it requires very little overhead.
To make everything as easy and versatile as possible, the Repose team will release Docker images on Docker Hub alongside every release of Repose.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="docker"><a class="anchor" href="#docker"></a>Docker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run Repose in Docker, there are just two basic steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Acquire a Repose Docker image.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Download the Docker image. See: <a href="#docker-image">Docker Image</a></p>
</li>
<li>
<p>Build the Docker image. See: <a href="#dockerfile">Dockerfile</a></p>
</li>
</ol>
</div>
</li>
<li>
<p>Run the Repose Docker image in a Docker container. See: <a href="#docker-container">Docker Container</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To find out more about Docker, including how to install and operate it, visit the official Docker documentation at:</p>
</div>
<div class="paragraph">
<p><a href="https://docs.docker.com/" class="bare">https://docs.docker.com/</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="docker-image"><a class="anchor" href="#docker-image"></a>Docker Image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All official, published Docker images for Repose, can be found on Docker Hub at:</p>
</div>
<div class="paragraph">
<p><a href="https://hub.docker.com/r/rackerlabs/repose/" class="bare">https://hub.docker.com/r/rackerlabs/repose/</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dockerfile"><a class="anchor" href="#dockerfile"></a>Dockerfile</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Dockerfile used to build the Docker images has been copied below for the sake of convenience.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Use Ubuntu as a base, since it works and is familiar.
# The version should be the latest tested, LTS version.
FROM ubuntu:16.04

MAINTAINER The Repose Team &lt;reposecore@rackspace.com&gt;

# This build-arg is used to pass the Repose version number which will be set up in this image.
ARG REPOSE_VERSION

# Install Repose (and Java) from the Debian package repository.
RUN apt-get update -qq &amp;&amp; apt-get install -qq -y wget openjdk-8-jre-headless
RUN wget --quiet -O - http://repo.openrepose.org/debian/pubkey.gpg | apt-key add - &amp;&amp; echo 'deb http://repo.openrepose.org/debian stable main' &gt; /etc/apt/sources.list.d/openrepose.list
RUN apt-get update -qq &amp;&amp; apt-get install -y repose-valve=$REPOSE_VERSION repose-filter-bundle=$REPOSE_VERSION repose-extensions-filter-bundle=$REPOSE_VERSION repose-experimental-filter-bundle=$REPOSE_VERSION

ENV APP_ROOT=/etc/repose
ENV APP_VARS=/var/repose
ENV APP_LOGS=/var/log/repose

# Turn off local logging
RUN sed -i 's,&lt;\(Appender.*RollingFile.*/\)&gt;,&lt;!--\1--&gt;,' ${APP_ROOT}/log4j2.xml
RUN sed -i 's,&lt;\(Appender.*PhoneHomeMessages.*/\)&gt;,&lt;!--\1--&gt;,' ${APP_ROOT}/log4j2.xml

# Arbitrary User ID support
RUN chgrp -R 0 ${APP_ROOT} ${APP_VARS} ${APP_LOGS} &amp;&amp; \
    chmod -R g=u ${APP_ROOT} ${APP_VARS} ${APP_LOGS}

# Expose APP_ROOT as a volume for mounting.
WORKDIR ${APP_ROOT}
VOLUME ${APP_ROOT}

# Switch user to repose
USER repose

# Expose the default Repose service port for host port forwarding.
# If the port in the user's system model differs from this port, the user will have to map it manually using the
# "-p" flag with the Docker run command.
EXPOSE 8080

# This environment variable is used to set command-line options.
# The user can manually set these options using the "-e" flag with the Docker run command.
ENV JAVA_OPTS=

# Start Repose.
CMD java $JAVA_OPTS -jar /usr/share/repose/repose-valve.jar -c /etc/repose</pre>
</div>
</div>
<div class="paragraph">
<p>To modify and/or build a Repose Docker image from the Dockerfile, follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Acquire a Repose Dockerfile.</p>
</li>
<li>
<p><strong>(Optional)</strong> Modify the Dockerfile.</p>
</li>
<li>
<p>Run the following command to build the Dockerfile:</p>
<div class="listingblock">
<div class="content">
<pre>docker build --build-arg REPOSE_VERSION=9.9.9.9 -t my_repose_image /path/to/</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s break that command down and take a closer look at what it is doing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>docker build</strong> - This is the part of the command that tells Docker to build the image.</p>
</li>
<li>
<p><strong>--build-args REPOSE_VERSION=9.9.9.9</strong> - This option defines the version of Repose that will be installed in the image.
The REPOSE_VERSION key will be given a value of 9.9.9.9 which can be used inside the Dockerfile.
It exists so that we can build Docker images for any version of Repose using a single Dockerfile.</p>
</li>
<li>
<p><strong>-t my_repose_image</strong> - This option defines the tag (in repository:tag format) to apply to the image.</p>
</li>
<li>
<p><strong>/path/to/</strong> - This is the path to the Repose Dockerfile.
The Dockerfile itself must exist as a child of the provided directory.
Note that this directory will also be treated as the Docker build context.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If the Dockerfile was successfully built, a Docker image should be available within Docker.
Run the following command to show all available images:</p>
<div class="listingblock">
<div class="content">
<pre>docker images</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="docker-container"><a class="anchor" href="#docker-container"></a>Docker Container</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="running"><a class="anchor" href="#running"></a>Running</h3>
<div class="paragraph">
<p>After you have acquired a Repose Docker image, you can run Repose by creating and starting a Docker container from that image.
For example, the following command could be use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>docker run                             \ <i class="conum" data-value="1"></i><b>(1)</b>
   -d                                  \ <i class="conum" data-value="2"></i><b>(2)</b>
   -v /my/config/directory:/etc/repose \ <i class="conum" data-value="3"></i><b>(3)</b>
   -p 8080:8080                        \ <i class="conum" data-value="4"></i><b>(4)</b>
   --name my_repose                    \ <i class="conum" data-value="5"></i><b>(5)</b>
   rackerlabs/repose:latest              <i class="conum" data-value="6"></i><b>(6)</b></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s break that command down and take a closer look at what it is doing:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is the part of the command that tells Docker to create and start a container.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This flag will run the container in detached mode.
In detached mode, the container will run in the background.
If we were to run in attached mode (the default) instead of detached mode, the terminal we used to execute this command would receive all of the output (i.e., STDIN, STDOUT, and STDERR) from the container.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This option defines a volume that is mounted from the host (i.e., the OS running Docker) onto the Docker container.
The volume mapping format is HOST_DIRECTORY:CONTAINER_DIRECTORY, so in this case, the contents of /my/config/directory on the host will be visible within the /etc/repose directory in the container.
This allows us to modify configuration files without having to rebuild the Docker image or restart the Docker container!</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>This option defines a port mapping between the host (i.e., the OS running Docker) and the Docker container.
Doing so allows Repose to accept traffic over the specified port from outside of Docker.
The port mapping format is HOST_PORT:CONTAINER_PORT, so in this case, traffic on port 8080 of the host will be forwarded to port 8080 of the container.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>This option names the container so that it&#8217;s easier to interact with.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>This is the image ID (in repository:tag format) to create a container from.
Remember that Repose images are hosted at Docker Hub, which Docker can use implicitly.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now if we wanted to, we could change the Docker options that define the environment that Repose will run in.
If we wanted to forward the random ports instead of explicitly declaring the port mapping, we could drop the <code>-p 8080:8080</code> option and pass the <code>-P</code> flag instead.</p>
</div>
<div class="paragraph">
<p>After running that command, you should be able to see Repose running inside a Docker container!
Use the following command to show all running containers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>docker ps</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="inspecting"><a class="anchor" href="#inspecting"></a>Inspecting</h3>
<div class="paragraph">
<p>Once running, you may wish to inspect the internal state of the container.
Well, the default command for the official Repose Docker images will run Repose in the foreground, and as a result, simply attaching to the container with a command like the following will only allow interaction with the Repose process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>docker attach container_name_or_id</pre>
</div>
</div>
<div class="paragraph">
<p>Instead, you can use a command like the following to run a new bash session inside of your running container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>docker exec -it container_name_or_id /bin/bash</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="log-files"><a class="anchor" href="#log-files"></a>Log Files</h3>
<div class="paragraph">
<p>If you need to access Repose log files, the recommended way of doing so would be to mount a Docker volume when starting the container using a command like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>docker run -d -v /my/config/directory:/etc/repose -v /var/log/repose:/var/log/repose -p 8080:8080 --name my_repose rackerlabs/repose:latest</pre>
</div>
</div>
<div class="paragraph">
<p>You will notice that this command is very similar to the command provided in the <a href="#running">Running</a> section, but with one more option: <code>-v /var/log/repose:/var/log/repose</code>.
This option simply mounts the Repose log directory in the container to the same directory on the host.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="notices"><a class="anchor" href="#notices"></a>Notices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Custom artifacts are not currently supported by our Docker images.
If you would like to deploy custom code in Repose running in Docker, please <a href="../welcome/contact-us.html">Contact Us</a>!</p>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script src="/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script src="/_javascripts/page-loader.js" type="text/javascript"></script>
  <script src="/_javascripts/include-html.js" type="text/javascript"></script>
  <script>includeHTML();</script>
  <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>